!function(){"use strict";function e(e){t();const{latex:n="",mode:a="inline",onSubmit:o,onCancel:l}=e;let c=a;const s=document.createElement("div");s.className="mathjax-popup";const i=document.createElement("div");i.className="mathjax-popup-header";const d=document.createElement("div");d.className="mathjax-popup-title",d.textContent="Insert Math Equation";const m=document.createElement("button");m.className="mathjax-popup-close",m.innerHTML="Ã—",m.onclick=()=>{l&&l(),t()},i.appendChild(d),i.appendChild(m);const p=document.createElement("div");p.className="mathjax-popup-content";const r=document.createElement("label");r.className="mathjax-popup-label",r.textContent="LaTeX Equation";const u=document.createElement("textarea");function h(){u.style.height="auto",u.style.height=u.scrollHeight+"px"}u.className="mathjax-popup-input",u.value=n,u.autofocus=!0,u.wrap="soft",u.addEventListener("input",h),setTimeout(h,0);const x=document.createElement("div");x.className="mathjax-popup-mode-container";const f=document.createElement("span");f.className="mathjax-popup-label",f.textContent="Mode:";const v=document.createElement("button");v.type="button",v.className="mathjax-popup-mode-btn",v.textContent="block"===c?"Display mode":"Inline mode",v.onmouseover=()=>{v.classList.add("hover")},v.onmouseout=()=>{v.classList.remove("hover")},v.onclick=()=>{c="block"===c?"inline":"block",v.textContent="block"===c?"Display mode":"Inline mode",P()},x.appendChild(f),x.appendChild(v);const b=document.createElement("label");b.className="mathjax-popup-preview-label",b.textContent="Preview";const C=document.createElement("div");C.className="mathjax-popup-preview";const g=document.createElement("div");g.className="mathjax-popup-footer";const y=document.createElement("button");y.type="button",y.className="mathjax-popup-cancel",y.textContent="Cancel",y.onclick=()=>{l&&l(),t()};const E=document.createElement("button");E.type="button",E.className="mathjax-popup-insert",E.textContent="Insert",E.onclick=()=>{o(u.value,c),t()};const $=document.createElement("div");$.className="mathjax-popup-resize-handle",p.appendChild(r),p.appendChild(u),p.appendChild(x),p.appendChild(b),p.appendChild(C),g.appendChild(y),g.appendChild(E),s.appendChild(i),s.appendChild(p),s.appendChild(g),s.appendChild($),document.body.appendChild(s);let L,k,M,N,j=!1;let w,B,I=!1;function P(){C.innerHTML=function(e,t){const n=function(e){return e.replace(/^\\\[(.*)\\\]$/s,"$1").replace(/^\\\((.*)\\\)$/s,"$1").replace(/^\$\$(.*)\$\$$/s,"$1").trim()}(e);return"block"===t?`\\[${n}\\]`:`\\(${n}\\)`}(u.value,c),"undefined"!=typeof MathJax&&MathJax.typesetPromise&&MathJax.typesetPromise([C])}i.addEventListener("mousedown",(function(e){if(e.target===m||e.target===$)return;j=!0,s.classList.add("dragging");const t=s.getBoundingClientRect();M=t.left,N=t.top,L=e.clientX,k=e.clientY})),document.addEventListener("mousemove",(function(e){if(!j)return;e.preventDefault();const t=e.clientX-L,n=e.clientY-k;s.style.left=`${M+t}px`,s.style.top=`${N+n}px`,s.style.transform="none"})),document.addEventListener("mouseup",(function(){j=!1,s.classList.remove("dragging")})),$.addEventListener("mousedown",(function(e){if(e.target!==$)return;I=!0,s.classList.add("resizing");const t=s.getBoundingClientRect();w=t.width,B=t.height,L=e.clientX,k=e.clientY})),document.addEventListener("mousemove",(function(e){if(!I)return;e.preventDefault();const t=e.clientX-L,n=e.clientY-k,a=Math.max(400,w+t),o=Math.max(300,B+n);s.style.width=`${a}px`,s.style.height=`${o}px`})),document.addEventListener("mouseup",(function(){I=!1,s.classList.remove("resizing")})),u.oninput=P,P(),u.onkeydown=e=>{"Enter"!==e.key||e.shiftKey?"Escape"===e.key&&(e.preventDefault(),l&&l(),t()):(e.preventDefault(),o(u.value,c),t())}}function t(){const e=document.querySelector(".mathjax-popup");e&&e.remove()}function n(e){return e.replace(/^\\\[(.*)\\\]$/s,"$1").replace(/^\\\((.*)\\\)$/s,"$1").replace(/^\$\$(.*)\$\$$/s,"$1").trim()}tinymce.PluginManager.add("math",(t=>{console.log("Math plugin loaded!"),t.ui.registry.addIcon("math-custom",'<svg width="24" height="24" focusable="false"><path fill-rule="evenodd" clip-rule="evenodd" d="M9 4.8c.1-.5.5-.8 1-.8h10a1 1 0 1 1 0 2h-9.2L8.3 19.2a1 1 0 0 1-1.7.4l-3.4-4.2a1 1 0 0 1 1.6-1.2l2 2.5L9 4.8Zm9.7 5.5c.4.4.4 1 0 1.4L17 13.5l1.8 1.8a1 1 0 1 1-1.4 1.4L15.5 15l-1.8 1.8a1 1 0 0 1-1.4-1.4l1.8-1.8-1.8-1.8a1 1 0 0 1 1.4-1.4l1.8 1.8 1.8-1.8a1 1 0 0 1 1.4 0Z"></path></svg>'),t.ui.registry.addButton("math",{icon:"math-custom",tooltip:"Math",onAction:()=>{e({latex:"",mode:"inline",onSubmit:(e,a)=>function(e,t,a){const o=n(t).replace(/\r?\n/g,"\n");let l="";"block"===a?(l=`<div class="math-tex math-tex-block" contenteditable="false" data-latex="${encodeURIComponent(t)}">\\[${o}\\]</div>`,e.insertContent("</p>"+l+"<p><br></p>")):(l=`<span class="math-tex" contenteditable="false" data-latex="${encodeURIComponent(t)}">\\(${o}\\)</span>`,e.insertContent(l)),setTimeout((()=>{const t=e.getBody().querySelectorAll(".math-tex");t.length&&"undefined"!=typeof MathJax&&MathJax.typesetPromise&&MathJax.typesetPromise([t[t.length-1]]),e.getBody().querySelectorAll(".math-tex-block").forEach((e=>{const t=e.previousSibling,n=e.nextSibling;t&&"P"===t.nodeName&&""===t.textContent?.trim()&&t.remove(),n&&"P"===n.nodeName&&""===n.textContent?.trim()&&n.remove()})),Array.from(e.getBody().querySelectorAll("p")).forEach((e=>{if(1===e.childElementCount&&e.firstElementChild?.classList.contains("math-tex-block")){const t=e.firstElementChild,n=e.parentNode;if(n){n.insertBefore(document.createElement("p"),e),n.insertBefore(t,e);const a=document.createElement("p");a.innerHTML="<br>",n.insertBefore(a,e.nextSibling),e.remove()}}}))}),0)}(t,e,a),onCancel:()=>{}})}}),t.on("dblclick",(a=>{const o=a.target.closest(".math-tex");if(o){let a="",l="inline";o.classList.contains("math-tex-block")&&(l="block"),o.getAttribute("data-latex")?a=decodeURIComponent(o.getAttribute("data-latex")||""):(a=o.textContent||"",a=n(a)),e({latex:a,mode:l,onSubmit:(e,a)=>{const l=n(e);o.outerHTML="block"===a?`<div class="math-tex math-tex-block" contenteditable="false" data-latex="${encodeURIComponent(e)}">\\[${l}\\]</div>`:`<span class="math-tex" contenteditable="false" data-latex="${encodeURIComponent(e)}">\\(${l}\\)</span>`,"undefined"!=typeof MathJax&&MathJax.typesetPromise&&setTimeout((()=>MathJax.typesetPromise([t.getBody()])),0)},onCancel:()=>{}})}}))}))}();
